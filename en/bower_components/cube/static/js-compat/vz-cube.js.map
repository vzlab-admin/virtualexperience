{"version":3,"sources":["../js/vz-cube.js"],"names":["map","n","start1","stop1","start2","stop2","constraint","min","max","Math","VZCubeElement","initialR","pitch","yaw","currentR","eventStack","pivot","querySelector","style","cursor","_mouseDownListener","bind","_mouseUpListener","_mouseMoveListener","_touchStartListener","_touchEndListener","_touchMoveListener","_refresh","addEventListener","cancelAnimationFrame","refreshPointer","clearTimeout","Object","assign","interaction","push","e","window","startInteraction","removeEventListener","endInteraction","addInteraction","x","pageX","y","pageY","t","timeStamp","preventDefault","touches","length","firstEvent","lastEvent","deltaX","deltaY","perspective","parseInt","getComputedStyle","transform","requestAnimationFrame","setTimeout","HTMLElement","document","registerElement","target","varArgs","TypeError","to","index","arguments","nextSource","nextKey","prototype","hasOwnProperty","call"],"mappings":"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","file":"vz-cube.js","sourcesContent":["/** @see https://github.com/processing/p5.js/blob/master/src/math/calculation.js */\nfunction map(n, start1, stop1, start2 = 0, stop2 = 1) {\n    return ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2\n}\nfunction constraint(n, min = 0, max = 1) {\n    return Math.min(Math.max(n, min), max)\n}\n\n/**\n * @TODO inertia\n * @TODO get/set props from attrs\n * @TODO motion sensors (how to conciliate with pointer events)\n * @TODO relativize mouse movement to viewport-size\n */\nclass VZCubeElement extends HTMLElement {\n    createdCallback() {\n        this.initialR = { pitch: 0, yaw: 0 }\n        this.currentR = { pitch: 0, yaw: 0 }\n        this.eventStack = []\n\n        // elements\n        this.pivot = this.querySelector('vz-cubepivot')\n\n        // styles\n        this.style.cursor = 'move'\n\n        // events\n        this._mouseDownListener = this._mouseDownListener.bind(this)\n        this._mouseUpListener = this._mouseUpListener.bind(this)\n        this._mouseMoveListener = this._mouseMoveListener.bind(this)\n        this._touchStartListener = this._touchStartListener.bind(this)\n        this._touchEndListener = this._touchEndListener.bind(this)\n        this._touchMoveListener = this._touchMoveListener.bind(this)\n        this._refresh = this._refresh.bind(this)\n\n        this.addEventListener('mousedown', this._mouseDownListener)\n        this.addEventListener('touchstart', this._touchStartListener, true)\n        this.addEventListener('touchmove', this._touchMoveListener, true)\n        this.addEventListener('touchend', this._touchEndListener, true)\n        this.addEventListener('touchcancel', this._touchEndListener, true)\n    }\n\n    attachedCallback() {\n        this._refresh()\n    }\n\n    detachedCallback() {\n        (typeof cancelAnimationFrame === 'function')\n            ? cancelAnimationFrame(this.refreshPointer)\n            : clearTimeout(this.refreshPointer)\n    }\n\n    startInteraction() {\n        Object.assign(this.initialR, this.currentR)\n        this.eventStack = []\n    }\n\n    addInteraction(interaction) {\n        this.eventStack.push(interaction)\n    }\n\n    endInteraction() {}\n\n    // ==============\n    // event handlers\n    // --------------\n\n    // mouse\n\n    _mouseDownListener(e) {\n        window.addEventListener('mousemove', this._mouseMoveListener)\n        window.addEventListener('mouseup', this._mouseUpListener)\n        this.startInteraction()\n    }\n\n    _mouseUpListener(e) {\n        window.removeEventListener('mousemove', this._mouseMoveListener)\n        window.removeEventListener('mouseup', this._mouseUpListener)\n        this.endInteraction()\n    }\n\n    _mouseMoveListener(e) {\n        this.addInteraction({ x: e.pageX, y: e.pageY, t: e.timeStamp })\n    }\n\n    // touch\n\n    _touchStartListener(e) {\n        this.startInteraction()\n    }\n\n    _touchEndListener(e) {\n        this.endInteraction()\n    }\n\n    _touchMoveListener(e) {\n        e.preventDefault()\n        this.addInteraction({ x: e.touches[0].pageX, y: e.touches[0].pageY, t: e.timeStamp })\n    }\n\n    // =========\n    // animation\n    // ---------\n\n    _refresh () {\n        if (this.eventStack.length >= 2 && this.pivot) {\n            let firstEvent = this.eventStack[0]\n            let lastEvent = this.eventStack[this.eventStack.length - 1]\n\n            // calculate deltas of this interaction\n            let deltaX = (lastEvent.x - firstEvent.x) * -0.2 // side-to-side movement\n            let deltaY = (lastEvent.y - firstEvent.y) * 0.2 // up-down movement\n\n            // apply deltas to the initial R of this interaction\n            this.currentR.yaw   = constraint(this.initialR.yaw + deltaY, -90, 90) // constraint rotation arount X axis (yaw)\n            this.currentR.pitch = this.initialR.pitch + deltaX\n\n            // apply current R to the pivot element\n            let perspective = parseInt(window.getComputedStyle(this).perspective)\n\n            this.pivot.style.transform = `translateZ(${perspective}px) rotateX(${this.currentR.yaw}deg) rotateY(${this.currentR.pitch}deg)`\n        }\n\n        // recurse\n        this.refreshPointer = (typeof cancelAnimationFrame === 'function')\n            ? requestAnimationFrame(this._refresh)\n            : setTimeout(this._refresh, 1000/60)\n    }\n}\ndocument.registerElement('vz-cube', VZCubeElement)\n\n\n\n// =====================================================\n//                        Polyfills\n// -----------------------------------------------------\n/**\n * @see https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Polyfill\n */\nif (typeof Object.assign != 'function') {\n    Object.assign = function (target, varArgs) { // .length of function is 2\n        'use strict';\n        if (target == null) { // TypeError if undefined or null\n            throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var to = Object(target);\n\n        for (var index = 1; index < arguments.length; index++) {\n            var nextSource = arguments[index];\n\n            if (nextSource != null) { // Skip over if undefined or null\n                for (var nextKey in nextSource) {\n                    // Avoid bugs when hasOwnProperty is shadowed\n                    if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                        to[nextKey] = nextSource[nextKey];\n                    }\n                }\n            }\n        }\n        return to;\n    };\n}\n"]}