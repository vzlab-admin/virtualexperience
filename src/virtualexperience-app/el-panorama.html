<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="stylesheet" href="../../bower_components/pannellum/css/pannellum.css">
<script src="../../bower_components/pannellum/js/libpannellum.js"></script>
<script src="../../bower_components/pannellum/js/pannellum.js"></script>

<dom-module id="el-panorama">
    <template>
        <style media="screen">
            #panorama {
                position: absolute;
                top: 0; right: 0; bottom: 0; left: 0;
            }
            #overlay {
                pointer-events: none;
                border: 1rem solid gold;
                position: absolute;
                top: 0; right: 0; bottom: 0; left: 0;
                /* center content */
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 1;
                transition: opacity 500ms ease-in-out;
                will-change: opacity;
            }
            #overlay.hidden {
                opacity: 0;
            }
        </style>

        <div id="panorama"></div>
        <div id="overlay">
            <div class="overlay">
                <!-- <hit-content logo="assets/images/shared/hitArea/logos/VWeVC.png" class="overlay style-scope main-router x-scope hit-content-0" style="pointer-events:none"> -->
                    <div class="borders style-scope hit-content">
                        <div class="corner top leFt style-scope hit-content" style="background-image:url('http://virtualexperience.vw.com.br/assets/images/shared/hitArea/Corner_TL.png')"></div>
                        <div class="horizo top style-scope hit-content" style="background-image:url('http://virtualexperience.vw.com.br/assets/images/shared/hitArea/Linha_T.png')"></div>
                        <div class="corner top right style-scope hit-content" style="background-image:url('http://virtualexperience.vw.com.br/assets/images/shared/hitArea/Corner_TR.png')"></div>
                        <div class="vertic right style-scope hit-content" style="background-image:url('http://virtualexperience.vw.com.br/assets/images/shared/hitArea/Linha_R.png')"></div>
                        <div class="corner bottom right style-scope hit-content" style="background-image:url('http://virtualexperience.vw.com.br/assets/images/shared/hitArea/Corner_BR.png')"></div>
                        <div class="horizo bottom style-scope hit-content" style="background-image:url('http://virtualexperience.vw.com.br/assets/images/shared/hitArea/Linha_B.png')"></div>
                        <div class="corner bottom left style-scope hit-content" style="background-image:url('http://virtualexperience.vw.com.br/assets/images/shared/hitArea/Corner_BL.png')"></div>
                        <div class="vertic left style-scope hit-content" style="background-image:url('http://virtualexperience.vw.com.br/assets/images/shared/hitArea/Linha_L.png')"></div>
                        <div class="meio style-scope hit-content"></div>
                    </div>

                    <div class="content style-scope hit-content">
                        <div class="contentText style-scope main-router">Você nunca viu a Volkswagen por este ângulo. <br class="style-scope main-router"> <b class="style-scope main-router">Ou melhor, por nenhum deles.</b></div>
                        <div class="previa style-scope hit-content">Clique e veja uma prévia da experiência.</div>
                    </div>
                <!-- </hit-content> -->


            </div>
        </div>
    </template>
    <script>
    Polymer({
        is: 'el-panorama',
        overlayHiddenTimeout: undefined,
        properties: {
            name: { type: String },
            autoload: { type: Boolean, value: true },
            autorotate: { type: Boolean, value: true },
            inactivity: { type: Number, value: 500 },
        },
        ready: function () {
            this.panorama = pannellum.viewer(this.$.panorama, {
                "type": "cubemap",
                "autoRotate": this.autorotate,
                "autoLoad": this.autoload,
                "showZoomCtrl": false,
                "keyboardZoom": false,
                "mouseZoom": false,
                "showFullscreenCtrl": false,
                "showControls": false,
                "cubeMap": [
                    'assets/images/panoramas/' + this.name + '/front.jpg',
                    'assets/images/panoramas/' + this.name + '/right.jpg',
                    'assets/images/panoramas/' + this.name + '/back.jpg',
                    'assets/images/panoramas/' + this.name + '/left.jpg',
                    'assets/images/panoramas/' + this.name + '/top.jpg',
                    'assets/images/panoramas/' + this.name + '/bottom.jpg',
                ]
            })
            this.refreshMe()

            // import prototype functions to object
            this._mouseDownHandler = this._mouseDownHandler.bind(this)
            this._mouseUpHandler = this._mouseUpHandler.bind(this)
            this._touchStartHandler = this._touchStartHandler.bind(this)
            this._touchEndHandler = this._touchEndHandler.bind(this)
        },
        refreshMe: function () {
            var renderer = this.panorama.getRenderer()
            if (renderer) {
                renderer.resize()
            }
            if (window.requestAnimationFrame !== undefined) window.requestAnimationFrame(this.refreshMe.bind(this))
            else setTimeout(this.refreshMe.bind(this), 1000/60)
        },
        attached: function () {
            // mouse events
            this.addEventListener('mousedown', this._mouseDownHandler)

            // touch events
            this.addEventListener('touchstart', this._touchStartHandler, { passive: true })
            this.addEventListener('touchstart', this._touchEndHandler, { passive: true })
        },
        _mouseDownHandler: function (e) {
            window.addEventListener('mouseup', this._mouseUpHandler)
            this.hideOverlay()
        },
        _mouseUpHandler: function (e) {
            window.removeEventListener('mouseup', this._mouseUpHandler)
            this.refreshHiddenOverlay()
        },
        _touchStartHandler: function (e) {
            this.hideOverlay()
        },
        _touchEndHandler: function (e) {
            this.refreshHiddenOverlay()
        },

        refreshHiddenOverlay: function () {
            if (this.overlayHiddenTimeout) {
                clearTimeout(this.overlayHiddenTimeout)
            }
            this.hideOverlay()
            this.overlayHiddenTimeout = setTimeout(this.showOverlay.bind(this), 1000)
        },
        showOverlay: function () {
            console.log('show overlay')
            if (this.$.overlay && this.$.overlay.classList) this.$.overlay.classList.remove('hidden')
        },
        hideOverlay: function () {
            console.log('hide overlay')
            if (this.$.overlay && this.$.overlay.classList) this.$.overlay.classList.add('hidden')
        },
    })
    </script>
</dom-module>
