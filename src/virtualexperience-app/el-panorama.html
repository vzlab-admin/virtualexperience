<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/cube/static/webcomponents/vz-cube.html">

<dom-module id="el-panorama">
    <template>
        <style media="screen">
            :host {
                position: absolute;
                top: 0; right: 0; bottom: 0; left: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                overflow: hidden;
            }
            #overlay {
                pointer-events: none;
                border: 1rem solid gold;
                position: absolute;
                top: 0; right: 0; bottom: 0; left: 0;
                /* center content */
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 1;
                transition: opacity 500ms ease-in-out;
                will-change: opacity;
            }
            #overlay.hidden {
                opacity: 0;
            }
        </style>

        <vz-cube>
            <vz-cubepivot>
                <vz-cubeface data-face="top" style="background-image: url(assets/images/panoramas/[[name]]/top.jpg)"></vz-cubeface>
                <vz-cubeface data-face="bottom" style="background-image: url(assets/images/panoramas/[[name]]/bottom.jpg)"></vz-cubeface>
                <vz-cubeface data-face="front" style="background-image: url(assets/images/panoramas/[[name]]/front.jpg)"></vz-cubeface>
                <vz-cubeface data-face="back" style="background-image: url(assets/images/panoramas/[[name]]/back.jpg)"></vz-cubeface>
                <vz-cubeface data-face="left" style="background-image: url(assets/images/panoramas/[[name]]/left.jpg)"></vz-cubeface>
                <vz-cubeface data-face="right" style="background-image: url(assets/images/panoramas/[[name]]/right.jpg)"></vz-cubeface>
            </vz-cubepivot>
        </vz-cube>
        <div id="overlay">
            <div>
                <p>Se você quer saber, o que se passa aqui dentro:<br>
                Eu vou mostrar pra você;</p>
                <p>Você vai entender a <strong>força do pensamento.</strong></p>
            </div>
        </div>

    </template>
    <script>
    Polymer({
        is: 'el-panorama',
        properties: {
            name: { type: String },
            autoload: { type: Boolean, value: true },
            autorotate: { type: Boolean, value: true },
            overlayReappearTimer: { type: Number, value: 2000 }, // ms
        },
        ready: function () {
            // import prototype functions to object
            this._mouseDownHandler = this._mouseDownHandler.bind(this)
            this._mouseUpHandler = this._mouseUpHandler.bind(this)
            this._touchStartHandler = this._touchStartHandler.bind(this)
            this._touchEndHandler = this._touchEndHandler.bind(this)
        },
        attached: function () {
            // mouse events
            this.addEventListener('mousedown', this._mouseDownHandler)
            // touch events
            this.addEventListener('touchstart', this._touchStartHandler, { passive: true })
            this.addEventListener('touchend', this._touchEndHandler, { passive: true })
            this.addEventListener('touchcancel', this._touchEndHandler, { passive: true })
        },

        delayedShowOverlay: function () {
            if (this.overlayHiddenTimeout) clearTimeout(this.overlayHiddenTimeout)

            this.overlayHiddenTimeout = setTimeout(this.showOverlay.bind(this), this.overlayReappearTimer)
        },
        showOverlay: function () {
            console.log('show')
            if (this.$.overlay && this.$.overlay.classList) this.$.overlay.classList.remove('hidden')
        },
        hideOverlay: function () {
            if (this.overlayHiddenTimeout) clearTimeout(this.overlayHiddenTimeout)
            
            if (this.$.overlay && this.$.overlay.classList) this.$.overlay.classList.add('hidden')
        },

        _mouseDownHandler: function (e) {
            window.addEventListener('mouseup', this._mouseUpHandler)
            this.hideOverlay()
        },
        _mouseUpHandler: function (e) {
            window.removeEventListener('mouseup', this._mouseUpHandler)
            this.delayedShowOverlay()
        },
        _touchStartHandler: function (e) {
            this.hideOverlay()
        },
        _touchEndHandler: function (e) {
            this.delayedShowOverlay()
        },

    })
    </script>
</dom-module>
