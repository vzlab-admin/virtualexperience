<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="el-overlay-octagon.html">

<dom-module id="panel-up-slider">
    <template>
        <style>
        :host {
            display: block;
            position: relative;
        }
        .panel-up-slider-bg,
        .panel-up-slider-bg__bg {
            position: absolute;
            background-image: url(../../assets/old-images/Concierge/montagem.jpg);
            background-size: cover;
            background-position: center;
            left: 0; top: 0;
            width: 100%; height: 100%;
        }
        .panel-up-slider-bg__bg {

        }
        .panel-up-slider-bg__bg--1 {
            background-image: url(../../assets/old-images/Concierge/montagem_disco.png);
            /*background-position: calc(50% - 160.956px) calc(50% - 8.80741px);*/
        }
        .panel-up-slider-bg__bg--2 {
            background-image: url(../../assets/old-images/Concierge/montagem_freio.png);
            /*background-position: calc(50% - 311.068px) calc(50% - 19.8167px);*/
        }
        /**
         * Slider
         */
        .panel-up-slider-slider {
            position: absolute;
            left: 0; bottom: 20%;
            width: 100%;
            margin: 0 auto;
            /*background: hsla(210, 13%, 50%, .5);*/
        }
        .panel-up-slider-slider__range {
            display: block;
            width: 960px;
            max-width: 80%;
            margin: 0 auto;
        }
        /**
         * Overlay
         */
        .panel-up-slider-overlay {
            pointer-events: none;
            position: absolute;
            left: 0; top: 0;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            opacity: 1;
            transition: opacity 1000ms ease-in-out;
            will-change: opacity;
        }
        .panel-up-slider-overlay.hidden {
            opacity: 0;
            transition-duration: 300ms;
        }
        </style>

        <div class="panel-up-slider-bg">
            <div class="panel-up-slider-bg__bg panel-up-slider-bg__bg--1" id="bg1"></div>
            <div class="panel-up-slider-bg__bg panel-up-slider-bg__bg--2" id="bg2"></div>
        </div>

        <div class="panel-up-slider-slider">
            <input type="range" class="panel-up-slider-slider__range" value=0 min="0" max="1" step="0.001" id="slider">
        </div>

        <div class="panel-up-slider-overlay" id="overlay">
            <el-overlay-octagon logo-src="assets/images/logos/4.png" logo-alt="up! HoloView">
                <p>
                    O futuro que você imaginava, agora na sua cabeça. <strong>Literalmente.</strong>
                </p>

                <p>
                    <em>Mova o indicador e veja uma prévia da experiência.</em>
                </p>
            </el-overlay-octagon>
        </div>

    </template>
    <script>
    Polymer({
        is: 'panel-up-slider',
        properties: {
            value: {
                type: Number,
                value: 0,
                reflectToAttribute: true,
            },
            overlayReappearTimer: { type: Number, value: 1000 }, // ms

        },
        ready: function () {
            this._onChangeSlider = this._onChangeSlider.bind(this)

            if (this.$.slider) {
                this.$.slider.addEventListener('input', this._onChangeSlider)
                this.$.slider.addEventListener('change', this._onChangeSlider)
            }

            this.setSlides()
        },
        setSlides: function () {
            if (this.$.bg1) {
                var bg1_x = (161 * this.value)
                var bg1_y = (9 * this.value)
                this.$.bg1.style.backgroundPosition = "calc(50% - " + bg1_x + "px) calc(50% - " + bg1_y + "px)"
            }
            if (this.$.bg2) {
                var bg2_x = (311 * this.value)
                var bg2_y = (20 * this.value)
                this.$.bg2.style.backgroundPosition = "calc(50% - " + bg2_x + "px) calc(50% - " + bg2_y + "px)"
            }
        },
        _onChangeSlider(e) {
            this.value = e.target.value
            this.setSlides()
            this.hideOverlay()
            this.delayedShowOverlay()
        },


        delayedShowOverlay: function () {
            if (this.overlayHiddenTimeout) clearTimeout(this.overlayHiddenTimeout)

            this.overlayHiddenTimeout = setTimeout(this.showOverlay.bind(this), this.overlayReappearTimer)
        },
        showOverlay: function () {
            if (this.$.overlay && this.$.overlay.classList) this.$.overlay.classList.remove('hidden')
        },
        hideOverlay: function () {
            if (this.overlayHiddenTimeout) clearTimeout(this.overlayHiddenTimeout)

            if (this.$.overlay && this.$.overlay.classList) this.$.overlay.classList.add('hidden')
        },

    })
    </script>
</dom-module>
